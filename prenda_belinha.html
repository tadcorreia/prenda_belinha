<!doctype html>
<html lang="pt-PT">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="color-scheme" content="dark light" />
  <title>Voucher Raspadinha ‚Äî Telem√≥vel da M√£e</title>
  <style>
    /* Tema ajustado para prenda pessoal, mobile-first */
    :root{
      --bg: #fff6ee; /* papel creme */
      --card: rgba(0,0,0,0.04);
      --card2: rgba(0,0,0,0.06);
      --text: #2b2b2b; /* castanho escuro */
      --muted: #6d6d6d;
      --stroke: rgba(0,0,0,0.06);
      --accent: #d93b4a; /* vermelho presente */
      --accent2: #f3b33d; /* dourado */
      --good: #3bff9a;
      --shadow: 0 14px 30px rgba(0,0,0,0.08);
      --radius: 14px;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: 'Segoe UI', 'Helvetica Neue', Arial, 'Segoe Print', 'Comic Sans MS', sans-serif;
      background: var(--bg);
      color: var(--text);
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }

    /* Um wrapper pequenino para dar o aspeto de prenda */
    .gift-header{
      display:flex; gap:12px; align-items:center; margin-bottom:18px;
    }
    .gift-bow{
      width:76px; height:76px; border-radius:12px; background:linear-gradient(135deg, var(--accent), #b92e3a); display:grid; place-items:center; color:#fff; font-size:34px; box-shadow:0 8px 20px rgba(0,0,0,0.08);
    }
    h1.gift-title{ margin:0; font-size: clamp(20px, 5.5vw, 28px); line-height:1.05; }
    .subtitle{ color:var(--muted); font-size:14px; }

    .wrap{
      max-width: 1100px;
      margin: 0 auto;
      padding: 32px 18px 48px;
    }

    header{
      display:flex;
      gap:16px;
      align-items:flex-start;
      justify-content:space-between;
      flex-wrap:wrap;
      margin-bottom: 18px;
    }

    .title{
      display:flex;
      flex-direction:column;
      gap:8px;
      max-width: 760px;
    }

    h1{
      margin:0;
      font-size: clamp(22px, 3.6vw, 36px);
      line-height:1.1;
      letter-spacing: -0.02em;
    }

    .subtitle{
      margin:0;
      color: var(--muted);
      font-size: 14px;
      line-height:1.5;
    }

    .pill{
      display:inline-flex;
      align-items:center;
      gap:10px;
      padding: 10px 12px;
      border: 1px solid var(--stroke);
      background: rgba(255,255,255,0.04);
      border-radius: 999px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.28);
      user-select:none;
    }

    .pill strong{ font-weight:700; }
    .pill .dot{
      width:10px;height:10px;border-radius:999px;
      background: var(--accent);
      box-shadow: 0 0 0 6px rgba(255,59,59,0.13);
    }

    .panel{
      border: 1px solid var(--stroke);
      background: linear-gradient(180deg, #fff, #fffef9);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
      padding: 14px;
    }

    /* Mobile-first: stack everything, depois ao largo mostrar lado-a-lado */
    .hero{
      display:grid;
      grid-template-columns: 1fr;
      gap: 12px;
      padding: 8px;
    }
    @media (min-width:860px){
      .hero{ grid-template-columns: 1.15fr 0.85fr; }
    }

    @media (max-width: 860px){
      .hero{ grid-template-columns: 1fr; }
    }

    .msg{
      padding: 18px;
      border-radius: calc(var(--radius) - 6px);
      background: rgba(0,0,0,0.20);
      border: 1px solid rgba(255,255,255,0.10);
      position:relative;
      overflow:hidden;
      min-height: 138px;
    }
    .msg:before{
      content:"";
      position:absolute; inset:-80px -120px auto auto;
      width: 280px; height: 280px;
      background: radial-gradient(circle at 30% 30%, rgba(255,59,59,0.35), transparent 60%);
      filter: blur(2px);
      transform: rotate(12deg);
      pointer-events:none;
    }
    .msg h2{
      margin:0 0 10px 0;
      font-size: 18px;
      letter-spacing: -0.01em;
    }
    .msg p{
      margin:0;
      color: var(--muted);
      font-size: 14px;
      line-height: 1.6;
      max-width: 62ch;
      position:relative;
      z-index:1;
    }

    .controls{
      display:flex;
      flex-direction:column;
      gap: 12px;
      padding: 18px;
      border-radius: calc(var(--radius) - 6px);
      background: rgba(0,0,0,0.18);
      border: 1px solid rgba(255,255,255,0.10);
      min-height: 138px;
    }

    .row{
      display:flex;
      gap: 10px;
      flex-wrap:wrap;
      align-items:center;
      justify-content:space-between;
    }

    button{
      appearance:none;
      border: 1px solid rgba(255,255,255,0.18);
      background: rgba(255,255,255,0.06);
      color: var(--text);
      padding: 10px 12px;
      border-radius: 12px;
      cursor:pointer;
      font-weight: 650;
      letter-spacing: 0.01em;
      transition: transform .08s ease, background .12s ease, border-color .12s ease;
      user-select:none;
    }
    button:hover{
      background: rgba(255,255,255,0.10);
      border-color: rgba(255,255,255,0.26);
    }
    button:active{ transform: translateY(1px); }
    button.primary{
      background: linear-gradient(135deg, rgba(255,59,59,0.95), rgba(255,138,59,0.92));
      border-color: rgba(255,59,59,0.35);
      color: #0b0f19;
    }
    button.primary:hover{
      filter: brightness(1.02);
      border-color: rgba(255,59,59,0.52);
    }

    .small{
      font-size: 12px;
      color: var(--muted);
      line-height:1.5;
    }

    .grid{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
      padding: 12px;
      border-top: 1px solid var(--stroke);
    }
    @media (max-width:600px){
      .grid{ grid-template-columns: 1fr; gap: 10px; }
    }
    @media (max-width: 860px){
      .grid{ grid-template-columns: 1fr; }
    }

    .scratch-card{
      position:relative;
      border-radius: 12px;
      border: 1px solid rgba(0,0,0,0.06);
      background: linear-gradient(180deg, #fff, #fffdf7);
      overflow:hidden;
      min-height: 170px;
      box-shadow: 0 6px 18px rgba(0,0,0,0.06);
    }

    .inner{
      padding: 16px 16px 12px;
      display:flex;
      flex-direction:column;
      gap: 10px;
      height:100%;
    }

    .who{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
    }

    .badge{
      display:inline-flex;
      align-items:center;
      gap: 8px;
      padding: 8px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.16);
      background: rgba(0,0,0,0.22);
      color: rgba(255,255,255,0.90);
      font-weight: 750;
      font-size: 13px;
      letter-spacing: 0.01em;
    }

    .emoji{
      width: 28px; height: 28px;
      border-radius: 10px;
      display:grid;
      place-items:center;
      background: rgba(255,255,255,0.08);
      border: 1px solid rgba(255,255,255,0.14);
    }

    .hint{
      color: var(--muted);
      font-size: 12px;
      line-height: 1.4;
      margin: 0;
    }

    .prize{
      flex:1;
      display:grid;
      place-items:center;
      border-radius: 12px;
      border: 1px dashed rgba(0,0,0,0.06);
      background: linear-gradient(180deg,#fffef8,#fffdf4);
      position:relative;
      overflow:hidden;
      min-height: 120px;
      padding: 10px;
    }

    .prize .value{
      text-align:center;
      padding: 10px 12px;
      position:relative;
      z-index:1;
    }

    .prize .value .amount{
      font-size: 34px;
      font-weight: 900;
      letter-spacing: -0.03em;
      line-height: 1.05;
    }
    .prize .value .label{
      margin-top: 8px;
      font-size: 13px;
      color: var(--muted);
      font-weight:700;
      letter-spacing: 0.01em;
    }

    .prize:before{
      content:"";
      position:absolute; inset:-60px auto auto -80px;
      width: 220px; height: 220px;
      background: radial-gradient(circle at 30% 30%, rgba(59,255,154,0.20), transparent 60%);
      transform: rotate(-12deg);
      pointer-events:none;
      filter: blur(1px);
    }

    canvas.scratch{
      position:absolute;
      inset:0;
      width:100%;
      height:100%;
      touch-action: none;
      cursor: crosshair;
      border-radius: 10px;
    }

    /* Modal final (surpresa) */
    .gift-modal{ position:fixed; inset:0; display:none; align-items:center; justify-content:center; background:linear-gradient(rgba(11,15,25,0.45), rgba(11,15,25,0.45)); z-index:10000; }
    .gift-modal .box{ background: #fff; color:var(--text); padding:18px; border-radius:14px; width:min(420px,92%); text-align:center; box-shadow:0 20px 40px rgba(0,0,0,0.12); }
    .gift-modal h3{ margin:0 0 8px 0; font-size:20px; }
    .gift-modal p{ margin:0 0 12px 0; color:var(--muted); }
    .gift-modal button{ padding:10px 14px; border-radius:10px; }

    .card-actions{
      display:flex;
      gap: 10px;
      justify-content:space-between;
      align-items:center;
      margin-top: 2px;
    }

    .progress{
      font-size: 12px;
      color: var(--muted);
    }

    .revealed-tag{
      display:none;
      font-size: 12px;
      padding: 6px 10px;
      border-radius: 999px;
      background: rgba(59,255,154,0.12);
      border: 1px solid rgba(59,255,154,0.28);
      color: rgba(255,255,255,0.90);
      font-weight: 700;
    }
    .scratch-card.revealed .revealed-tag{ display:inline-flex; }

    .footer{
      padding: 14px 18px 18px;
      border-top: 1px solid var(--stroke);
      color: var(--muted);
      font-size: 12px;
      line-height: 1.6;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 12px;
      flex-wrap:wrap;
    }

    /* Confetti */
    .confetti{
      position:fixed;
      inset:0;
      pointer-events:none;
      overflow:hidden;
      z-index: 9999;
    }
    .confetti span{
      position:absolute;
      top:-10px;
      width:10px; height:16px;
      border-radius: 3px;
      opacity: 0.9;
      transform: translateY(-20px) rotate(0deg);
      animation: fall linear forwards;
    }
    @keyframes fall{
      to { transform: translateY(calc(100vh + 40px)) rotate(540deg); opacity: 1; }
    }

    /* Print friendly */
    @media print{
      body{ background:#fff; color:#000; }
      .pill, button, .small, .confetti{ display:none !important; }
      .panel, .scratch-card{ box-shadow:none; }
    }
  </style>
</head>

<body>
  <div class="wrap">
    <header>
      <div class="gift-header">
        <div class="gift-bow">üéÅ</div>
        <div class="title">
          <h1 class="gift-title">Presente surpresa ‚Äî Para a M√£e</h1>
          <p class="subtitle">Raspa cada quadrado para descobrir os contributos. S√≥ no fim dizemos o que o presente √© ‚Äî √© surpresa!</p>
        </div>
      </div>

      <div class="pill" title="Dica: podes fazer print depois de revelar tudo.">
        <span class="dot" style="background:var(--accent);"></span>
        <span><strong id="progressText">0/3</strong> abertas</span>
      </div>
    </header>

    <section class="panel">
      <div class="hero">
        <div class="msg">
          <h2>Mensagem</h2>
          <p id="messageText">
            Para estares sempre ligada a n√≥s ‚Äî com fotos, chamadas, mensagens e tudo o que quiseres. Quando escolheres o telem√≥vel, n√≥s ajudamos no valor. üíõ
          </p>
        </div>

        <div class="controls">
          <div class="row">
            <button class="primary" id="revealAllBtn">Revelar tudo</button>
            <button id="resetBtn">Reiniciar raspadinha</button>
          </div>
          <div class="small">
            <div><strong>Personaliza√ß√£o r√°pida:</strong> abre este ficheiro e muda os nomes/valores no bloco <code>CONFIG</code> do JavaScript.</div>
            <div style="margin-top:6px;">Sugest√£o: usa isto em GitHub Pages e envia o link √† m√£e (ou abre no telem√≥vel dela no dia).</div>
          </div>
        </div>
      </div>

      <div class="grid" id="cardsGrid">
        <!-- Cards gerados por JS -->
      </div>

      <div class="footer">
        <div>Feito com ‚ù§Ô∏è ‚Äî ‚Äúraspadinha‚Äù digital (sem apps, s√≥ HTML).</div>
        <div>Dica: depois de revelar tudo, podes fazer <strong>Print</strong> para guardar.</div>
      </div>
    </section>
  </div>

  <div class="confetti" id="confetti" aria-hidden="true"></div>

<script>
/**
 * =========================
 * CONFIG (EDITA ISTO)
 * =========================
 */
const CONFIG = {
  motherName: "M√£e",
  totalGoalHint: "Para ajudar no telem√≥vel novo",
  message:
    "Para estares sempre ligada a n√≥s ‚Äî com fotos, chamadas, mensagens e tudo o que quiseres. Raspa para descobrir o que preparamos para ti. üíõ",
  // Mensagem final mostrada quando TODO estiver revelado
  finalRevealMessage: "Surpresa! √â para um telem√≥vel üì±",
  // Se true, a suposi√ß√£o "contribui√ß√£o para o telem√≥vel" s√≥ aparece no fim
  revealPurposeAtEnd: true,
  cards: [
    { name: "Tiago", emoji: "üéÅ", amount: 70, currency: "‚Ç¨" },
    { name: "Pedro", emoji: "‚ú®", amount: 70, currency: "‚Ç¨" },
    { name: "Maria", emoji: "üíõ", amount: 70, currency: "‚Ç¨" },
  ],
  // Quanto precisa de ser raspado (0 a 1). 0.55 = 55% do cinzento removido.
  revealThreshold: 0.55,
  // Tamanho do "pincel" da raspagem (em px, adaptado ao ecr√£)
  brushSize: 30,
  // Texto no overlay cinzento
  scratchLabel: "RASPA AQUI",
};

  document.getElementById("messageText").textContent = CONFIG.message;

// Inserir modal markup para a revela√ß√£o final
const finalModal = document.createElement('div');
finalModal.className = 'gift-modal';
finalModal.id = 'finalModal';
finalModal.innerHTML = `
  <div class="box" role="dialog" aria-modal="true">
    <h3>Surpresa!</h3>
    <p id="finalModalText">${escapeHtml(CONFIG.finalRevealMessage)}</p>
    <div style="margin-top:12px; display:flex; gap:8px; justify-content:center;">
      <button id="finalClose" class="primary">Est√° bem!</button>
      <button id="finalPrint">Imprimir</button>
    </div>
  </div>`;
document.body.appendChild(finalModal);
document.getElementById('finalClose').addEventListener('click', () => { finalModal.style.display = 'none'; });
document.getElementById('finalPrint').addEventListener('click', () => { window.print(); });

const grid = document.getElementById("cardsGrid");
const progressText = document.getElementById("progressText");
const confetti = document.getElementById("confetti");

let revealedCount = 0;

function formatMoney(amount, currency){
  // Formata√ß√£o simples para euros (PT)
  try{
    return new Intl.NumberFormat("pt-PT", { style:"currency", currency:"EUR" }).format(amount);
  } catch {
    return `${currency}${amount}`;
  }
}

  function createCard(card, idx){
  const wrapper = document.createElement("div");
  wrapper.className = "scratch-card";
  wrapper.setAttribute("data-index", String(idx));

  wrapper.innerHTML = `
    <div class="inner">
      <div class="who">
        <div class="badge">
          <span class="emoji" aria-hidden="true">${card.emoji ?? "üéÅ"}</span>
          <span>${escapeHtml(card.name)}</span>
        </div>
        <span class="revealed-tag">Revelado ‚úÖ</span>
      </div>

      <p class="hint">${escapeHtml(CONFIG.totalGoalHint)}</p>

      <div class="prize" role="group" aria-label="√Årea do pr√©mio">
        <div class="value">
          <!-- O valor est√° inicialmente escondido; √© inserido no DOM apenas quando revelado -->
          <div class="amount">‚Äî</div>
          <!-- Etiqueta gen√©rica at√© que todas as cartas estejam reveladas -->
          <div class="label">Presente surpresa</div>
        </div>
        <canvas class="scratch" aria-label="Raspadinha"></canvas>
      </div>

      <div class="card-actions">
        <div class="progress" data-progress>Raspa para revelar‚Ä¶</div>
        <button type="button" data-reveal>Revelar</button>
      </div>
    </div>
  `;

  const canvas = wrapper.querySelector("canvas.scratch");
  const revealBtn = wrapper.querySelector("[data-reveal]");
  const progressEl = wrapper.querySelector("[data-progress]");
  const prizeEl = wrapper.querySelector(".prize");

  // Init canvas
  const ctx = canvas.getContext("2d", { willReadFrequently: true });
  const state = {
    isDown: false,
    revealed: false,
    lastX: 0,
    lastY: 0,
    ratio: 0,
    dpr: Math.max(1, window.devicePixelRatio || 1),
  };

  function resizeCanvas(){
    const rect = prizeEl.getBoundingClientRect();
    canvas.width = Math.floor(rect.width * state.dpr);
    canvas.height = Math.floor(rect.height * state.dpr);
    canvas.style.width = rect.width + "px";
    canvas.style.height = rect.height + "px";
    ctx.setTransform(state.dpr, 0, 0, state.dpr, 0, 0);

    // Draw overlay (cinzento + textura leve)
    drawOverlay(rect.width, rect.height);
  }

  function drawOverlay(w, h){
    // Fundo cinzento
    ctx.globalCompositeOperation = "source-over";
    ctx.clearRect(0,0,w,h);

    const grad = ctx.createLinearGradient(0,0,w,h);
    grad.addColorStop(0, "rgba(255,255,255,0.20)");
    grad.addColorStop(1, "rgba(255,255,255,0.10)");
    ctx.fillStyle = grad;
    ctx.fillRect(0,0,w,h);

    // Pequenos "gr√£os"
    const dots = Math.floor((w*h)/2200);
    ctx.fillStyle = "rgba(0,0,0,0.12)";
    for(let i=0;i<dots;i++){
      const x = Math.random()*w;
      const y = Math.random()*h;
      ctx.fillRect(x,y,1,1);
    }

    // Texto ‚ÄúRASPA AQUI‚Äù
    ctx.save();
    ctx.translate(w/2, h/2);
    ctx.rotate(-0.12);
    ctx.textAlign = "center";
    ctx.textBaseline = "middle";
    ctx.font = "800 20px system-ui, -apple-system, Segoe UI, Roboto, Arial";
    ctx.fillStyle = "rgba(0,0,0,0.45)";
    ctx.fillText(CONFIG.scratchLabel, 0, 0);
    ctx.restore();

    // Define modo de raspagem (apagar)
    ctx.globalCompositeOperation = "destination-out";
  }

  function scratchLine(x0, y0, x1, y1){
    const w = prizeEl.getBoundingClientRect().width;
    const h = prizeEl.getBoundingClientRect().height;

    ctx.lineCap = "round";
    ctx.lineJoin = "round";
    ctx.strokeStyle = "rgba(0,0,0,1)";
    // Ajusta o tamanho do pincel para ecr√£s pequenos (melhor para toque)
    const base = CONFIG.brushSize;
    const brush = Math.max(18, Math.round(base * (w < 220 ? 0.8 : 1)));
    ctx.lineWidth = brush;
    ctx.beginPath();
    ctx.moveTo(x0, y0);
    ctx.lineTo(x1, y1);
    ctx.stroke();

    // "Carimbo" circular para garantir raspagem cont√≠nua
    ctx.beginPath();
    ctx.arc(x1, y1, brush/2, 0, Math.PI*2);
    ctx.fill();

    updateProgress(w, h);
  }

  function updateProgress(w, h){
    // Mede percentagem removida (com amostragem para ser r√°pido)
    const sw = Math.max(1, Math.floor(w/6));
    const sh = Math.max(1, Math.floor(h/6));
    // L√™ uma vers√£o reduzida da imagem (menos pixels)
    const img = ctx.getImageData(0,0,sw,sh);
    let clear = 0;
    for(let i=3;i<img.data.length;i+=4){
      if(img.data[i] === 0) clear++;
    }
    const total = img.data.length/4;
    const ratio = clear/total;
    state.ratio = ratio;

    const pct = Math.min(100, Math.max(0, Math.round(ratio*100)));
    progressEl.textContent = state.revealed ? "Revelado ‚úÖ" : `Raspado: ${pct}%`;

    if(!state.revealed && ratio >= CONFIG.revealThreshold){
      reveal();
    }
  }

  function pointerPos(evt){
    const rect = canvas.getBoundingClientRect();
    const x = (evt.clientX - rect.left);
    const y = (evt.clientY - rect.top);
    return { x, y };
  }

  function onDown(evt){
    if(state.revealed) return;
    state.isDown = true;
    canvas.setPointerCapture?.(evt.pointerId);
    const {x,y} = pointerPos(evt);
    state.lastX = x; state.lastY = y;
    scratchLine(x,y,x,y);
  }

  function onMove(evt){
    if(!state.isDown || state.revealed) return;
    const {x,y} = pointerPos(evt);
    scratchLine(state.lastX, state.lastY, x, y);
    state.lastX = x; state.lastY = y;
  }

  function onUp(){
    state.isDown = false;
  }

  function reveal(){
    if(state.revealed) return;
    state.revealed = true;

    // Apaga tudo do overlay
    ctx.globalCompositeOperation = "destination-out";
    const rect = prizeEl.getBoundingClientRect();
    ctx.clearRect(0,0,rect.width,rect.height);

    // Inserir o valor vis√≠vel apenas no momento em que √© revelado
    const amountEl = wrapper.querySelector(".amount");
    if(amountEl){
      amountEl.textContent = formatMoney(card.amount, card.currency);
    }

    wrapper.classList.add("revealed");
    revealBtn.disabled = true;
    canvas.style.pointerEvents = "none";
    progressEl.textContent = "Revelado ‚úÖ";

    revealedCount++;
    updateHeaderProgress();

    // Quando acabar, dispara confetti e mostra a mensagem final (ex.: "√© para um telem√≥vel")
    if(revealedCount === CONFIG.cards.length){
      fireConfetti();
      // Se quisermos apontar o prop√≥sito no final, atualiza as etiquetas
      if(CONFIG.revealPurposeAtEnd){
        document.querySelectorAll('.prize .label').forEach(l => l.textContent = 'contribui√ß√£o para o telem√≥vel');
      }
      // Mostra a modal de surpresa
      const fm = document.getElementById('finalModal');
      if(fm){ fm.style.display = 'flex'; }
    }
  }

  revealBtn.addEventListener("click", reveal);

  canvas.addEventListener("pointerdown", onDown);
  canvas.addEventListener("pointermove", onMove);
  window.addEventListener("pointerup", onUp);

  // Resize handling
  const ro = new ResizeObserver(() => {
    if(!state.revealed) resizeCanvas();
  });
  ro.observe(prizeEl);

  // Initial draw
  requestAnimationFrame(resizeCanvas);

  // Expor reset
  wrapper.__reset = () => {
    state.revealed = false;
    state.isDown = false;
    state.ratio = 0;
    revealBtn.disabled = false;
    canvas.style.pointerEvents = "auto";
    wrapper.classList.remove("revealed");
    const rect = prizeEl.getBoundingClientRect();
    drawOverlay(rect.width, rect.height);
    progressEl.textContent = "Raspa para revelar‚Ä¶";

    // Esconder novamente o valor quando reiniciamos
    const amountEl = wrapper.querySelector(".amount");
    if(amountEl){ amountEl.textContent = "‚Äî"; }
  };

  wrapper.__reveal = reveal;

  return wrapper;
}

function updateHeaderProgress(){
  progressText.textContent = `${revealedCount}/${CONFIG.cards.length}`;
}

function resetAll(){
  revealedCount = 0;
  updateHeaderProgress();
  clearConfetti();
  document.querySelectorAll(".scratch-card").forEach(card => card.__reset?.());
  // Esconde a modal de final e rep√µe etiquetas gen√©ricas
  const fm = document.getElementById('finalModal');
  if(fm){ fm.style.display = 'none'; }
  if(CONFIG.revealPurposeAtEnd){
    document.querySelectorAll('.prize .label').forEach(l => l.textContent = 'Presente surpresa');
  }
}

function revealAll(){
  document.querySelectorAll(".scratch-card").forEach(card => card.__reveal?.());
}

function fireConfetti(){
  clearConfetti();
  // cria 90 pedacinhos, com cores por CSS random via HSL
  const count = 90;
  for(let i=0;i<count;i++){
    const s = document.createElement("span");
    const left = Math.random()*100;
    const dur = 2.6 + Math.random()*2.2;
    const delay = Math.random()*0.25;
    const size = 6 + Math.random()*8;
    const hue = Math.floor(Math.random()*360);
    s.style.left = left + "vw";
    s.style.width = size + "px";
    s.style.height = (size*1.4) + "px";
    s.style.background = `hsl(${hue} 90% 60%)`;
    s.style.animationDuration = dur + "s";
    s.style.animationDelay = delay + "s";
    s.style.transform = `translateY(-20px) rotate(${Math.random()*180}deg)`;
    confetti.appendChild(s);

    // Remove no fim
    setTimeout(() => s.remove(), (dur+delay)*1000 + 200);
  }
}

function clearConfetti(){
  confetti.innerHTML = "";
}

function escapeHtml(str){
  return String(str ?? "")
    .replaceAll("&","&amp;")
    .replaceAll("<","&lt;")
    .replaceAll(">","&gt;")
    .replaceAll('"',"&quot;")
    .replaceAll("'","&#039;");
}

/**
 * Bootstrap
 */
function init(){
  grid.innerHTML = "";
  CONFIG.cards.forEach((c, idx) => grid.appendChild(createCard(c, idx)));
  updateHeaderProgress();

  document.getElementById("resetBtn").addEventListener("click", resetAll);
  document.getElementById("revealAllBtn").addEventListener("click", revealAll);
}

init();
</script>
</body>
</html>